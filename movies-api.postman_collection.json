{
	"info": {
    "_postman_id": "ffa11f6c-7f1d-4ef7-b9e1-c97ccb7852f9",
    "name": "movies-api",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
	"item": [
		{
			"name": "access",
			"item": [
				{
					"name": "[-] [GET] Защита авторизацией",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 401\", () => {\r",
									"    pm.response.to.have.status(401);\r",
									"});\r",
									"\r",
									"pm.test(\"Проверка возврата поля message\", () => {\r",
									"    pm.response.to.have.jsonSchema(JSON.parse(pm.collectionVariables.get(\"schema_message_only\")));\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableCookies": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "signup",
			"item": [
				{
					"name": "[-] [POST] Добавление пользователя с полем name меньше 2 символов",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'name', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{$randomEmail}}\",\r\n    \"password\": \"{{user_password}}\",\r\n    \"name\": \"{{$randomAlphaNumeric}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signup"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Добавление пользователя с полем name больше 30 символов",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'name', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{$randomEmail}}\",\r\n    \"password\": \"{{user_password}}\",\r\n    \"name\": \"{{$randomLoremSentences}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signup"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Добавление пользователя с некорректным email",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'email', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{user_email_incorrect}}\",\r\n    \"password\": \"{{user_password}}\",\r\n    \"name\": \"{{user_name}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signup"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Добавление пользователя без обязательного поля email",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'email', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"name\": \"{{user_name}}\",\r\n    \"password\": \"{{user_password}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signup"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Добавление пользователя без обязательного поля password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'password', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{$randomEmail}}\",\r\n    \"name\": \"{{user_name}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signup"
							]
						}
					},
					"response": []
				},
				{
					"name": "[+] [POST] Добавление пользователя без необязательных полей",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 200 или 201\", () => {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
									"});\r",
									"\r",
									"pm.test(\"В ответе не содержится password созданного пользователя\", () => {\r",
									"    const user = utils.getData(pm.response.json());\r",
									"\r",
									"    pm.expect(user).not.to.have.property('password');\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{user_email_second}}\",\r\n    \"name\": \"{{user_name}}\",\r\n    \"password\": \"{{$randomPassword}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signup"
							]
						}
					},
					"response": []
				},
				{
					"name": "[+] [POST] Добавление пользователя",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 200 или 201\", () => {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
									"});\r",
									"\r",
									"pm.test(\"Данные в ответе совпадают с переданными\", () => {\r",
									"    const user = utils.getData(pm.response.json());\r",
									"\r",
									"    pm.expect(user.name).to.eql(pm.collectionVariables.get(\"user_name\"));\r",
									"});\r",
									"\r",
									"pm.test(\"В ответе не содержится password созданного пользователя\", () => {\r",
									"    const user = utils.getData(pm.response.json());\r",
									"\r",
									"    pm.expect(user).not.to.have.property('password');\r",
									"});\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{user_email}}\",\r\n    \"password\": \"{{user_password}}\",\r\n    \"name\": \"{{user_name}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signup"
							]
						}
					},
					"response": []
				},
				{
					"name": "* Добавление доп. пользователя для теста добавления пользователя с существующим email в БД",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{user_email_third}}\",\r\n    \"password\": \"{{user_password}}\",\r\n    \"name\": \"{{user_name}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signup"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Добавление пользователя с существующим email в БД",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 409\", () => {\r",
									"    pm.response.to.have.status(409);\r",
									"});\r",
									"\r",
									"pm.test(\"Проверка возврата поля message\", () => {\r",
									"    pm.response.to.have.jsonSchema(JSON.parse(pm.collectionVariables.get(\"schema_message_only\")))\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{user_email_third}}\",\r\n    \"password\": \"{{user_password}}\",\r\n    \"name\": \"{{user_name}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signup"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "signin",
			"item": [
				{
					"name": "[-] [POST] Авторизация с несуществующими email и password в БД",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Код ответа равен 401\", () => {\r",
									"    pm.response.to.have.status(401);\r",
									"});\r",
									"\r",
									"pm.test(\"Проверка возврата поля message\", () => {\r",
									"    pm.response.to.have.jsonSchema(JSON.parse(pm.collectionVariables.get(\"schema_message_only\")))\r",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"test@test.ru\",\r\n    \"password\": \"12345678\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signin",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signin"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Авторизация с некорректным полем email",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'email', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{user_email_incorrect}}\",\r\n    \"password\": \"{{user_password}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signin",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signin"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Авторизация без обязательного поля email",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'email', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"password\": \"{{user_password}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signin",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signin"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Авторизация без обязательного поля password",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'password', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{user_email}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signin",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signin"
							]
						}
					},
					"response": []
				},
				{
					"name": "[+] [POST] Авторизация",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Код ответа равен 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"try {\r",
									"    const regex = /^[a-zA-Z0-9\\-_]+?\\.[a-zA-Z0-9\\-_]+?\\.([a-zA-Z0-9\\-_]+)?$/;\r",
									"    const data = utils.getData(pm.response.json());\r",
									"    const token = data.token || data[Object.keys(data)[0]];\r",
									"    if(regex.test(token)) {\r",
									"        tests[`Cервер вернул в теле ответа JWT-токен: ${token}`] = true\r",
									"        pm.collectionVariables.set(\"jwt_token\", token);\r",
									"    }\r",
									"} catch (e) {\r",
									"}"
								]
							}
						}
					],
					"protocolProfileBehavior": {
						"disabledSystemHeaders": {}
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{user_email}}\",\r\n    \"password\": \"{{user_password}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signin",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signin"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "users",
			"item": [
				{
					"name": "[+] [GET] Получение информации о пользователе",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 200\", function () {\r",
									"    pm.expect(pm.response.code).equals(200, \"Убедитесь, что сервер возвращает и принимает JWT-токен одинаково (при возврате cookies - сервер должен извлекать токен из них, если кук нет - из заголовков)\");\r",
									"});\r",
									"\r",
									"pm.test(\"Проверка возврата корректных данных\", () => {\r",
									"    const user = utils.getData(pm.response.json());\r",
									"\r",
									"    pm.expect(user.name).to.eql(pm.collectionVariables.get(\"user_name\"));\r",
									"    pm.expect(user.email).to.eql(pm.collectionVariables.get(\"user_email\"));\r",
									"});\r",
									"\r",
									"pm.test(\"В ответе отсутствует поле password\", () => {\r",
									"    const user = utils.getData(pm.response.json());\r",
									"\r",
									"    pm.expect(user).not.to.have.property('password');\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users/me",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"me"
							]
						}
					},
					"response": []
				},
				{
					"name": "[+] [GET] Получение списка пользователей",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Код ответа равен 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Проверка списка пользователей\", () => {\r",
									"    const users = utils.getData(pm.response.json());\r",
									"    pm.expect(users).to.be.an(\"array\");\r",
									"});\r",
									"\r",
									"pm.test(\"В ответе отсутствует поле password\", () => {\r",
									"    const users = utils.getData(pm.response.json());\r",
									"\r",
									"    pm.expect(users[0]).not.to.have.property('password');\r",
									"});\r",
									"\r",
									"const users = utils.getData(pm.response.json());\r",
									"const email = pm.collectionVariables.get(\"user_email\");\r",
									"const user = users?.find((item) => item.email === email);\r",
									"\r",
									"pm.collectionVariables.set(\"user_id\", user._id);"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
                "{{base_url}}"
              ],
              "path": [
                "users"
              ]
            }
          },
          "response": []
        },
        {
          "name": "[-] [PATCH] Обновление данных пользователя с существующим email",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Код ответа равен 409\", () => {\r",
                  "    pm.response.to.have.status(409);\r",
                  "});\r",
                  "\r",
                  "pm.test(\"Проверка возврата поля message\", () => {\r",
                  "    pm.response.to.have.jsonSchema(JSON.parse(pm.collectionVariables.get(\"schema_message_only\")))\r",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n    \"email\": \"{{user_email_third}}\",\r\n    \"name\": \"test\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/users/me",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "users",
                "me"
              ]
            }
          },
          "response": []
        },
        {
          "name": "[+] [PATCH] Обновление данных пользователя",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Код ответа равен 200\", function () {\r",
                  "    pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "pm.test(\"Данные в ответе совпадают с данными обновленного пользователя\", () => {\r",
                  "    const user = utils.getData(pm.response.json());\r",
                  "\r",
                  "    pm.expect(user.name).to.eql(pm.collectionVariables.get(\"user_name_changed\"));\r",
                  "    pm.expect(user.email).to.eql(pm.collectionVariables.get(\"user_email_changed\"));\r",
                  "});\r",
                  "\r",
                  "pm.test(\"В ответе отсутствует поле password\", () => {\r",
                  "    const user = utils.getData(pm.response.json());\r",
                  "\r",
                  "    pm.expect(user).not.to.have.property('password');\r",
                  "});"
                ],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
              "mode": "raw",
              "raw": "{   \r\n    \"name\": \"{{user_name_changed}}\",\r\n    \"email\": \"{{user_email_changed}}\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
						"url": {
							"raw": "{{base_url}}/users/me",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"me"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [PATCH] Обновление данных пользователя с полем name меньше 2 символов",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'name', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{   \r\n    \"name\": \"{{$randomAlphaNumeric}}\",\r\n    \"about\": \"{{user_about_changed}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users/me",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"me"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [PATCH] Обновление данных пользователя с полем name больше 30 символов",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'name', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{   \r\n    \"name\": \"{{$randomLoremSentences}}\",\r\n    \"about\": \"{{user_about_changed}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/users/me",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"me"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "movies",
			"item": [
				{
					"name": "[+] [POST] Добавление фильма",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 200 или 201\", () => {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
									"});\r",
									"\r",
									"pm.test(\"В ответе содержится id созданной карточки\", () => {\r",
									"    const movie = utils.getData(pm.response.json());\r",
									"\r",
									"    pm.expect(movie).to.have.property('_id');\r",
									"\r",
									"    pm.collectionVariables.set(\"movie_movieId\", movie._id);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
              "mode": "raw",
              "raw": "{\r\n    \"movieId\": \"{{movie_movieId_const}}\",\r\n    \"nameRU\": \"{{movie_nameRU}}\",\r\n    \"nameEN\": \"{{movie_nameEN}}\",\r\n    \"country\": \"{{movie_country}}\",\r\n    \"director\": \"{{movie_director}}\",\r\n    \"duration\": \"{{movie_duration}}\",\r\n    \"year\": \"{{movie_year}}\",\r\n    \"description\": \"{{movie_description}}\",\r\n    \"image\": \"{{movie_link}}\",\r\n    \"trailerLink\": \"{{movie_link}}\",\r\n    \"thumbnail\": \"{{movie_link}}\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
						"url": {
							"raw": "{{base_url}}/movies",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"movies"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Добавление фильма с некорректным url-адресом в поле link",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'link', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"movieId\": \"{{movie_movieId_const}}\",\r\n    \"nameRU\": \"{{movie_nameRU}}\",\r\n    \"nameEN\": \"{{movie_nameEN}}\",\r\n    \"country\": \"{{movie_country}}\",\r\n    \"director\": \"{{movie_director}}\",\r\n    \"duration\": \"{{movie_duration}}\",\r\n    \"year\": \"{{movie_year}}\",\r\n    \"description\": \"{{movie_description}}\",\r\n    \"image\": \"{{movie_link}}\",\r\n    \"trailerLink\": \"{{movie_link}}\",\r\n    \"thumbnail\": \"{{movie_link}}\",\r\n    \"link\": \"{{movie_link_incorrect}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/movies",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"movies"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [POST] Добавление карточки без обязательного поля nameRU",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'nameRU', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
              "mode": "raw",
              "raw": "{\r\n    \"movieId\": \"{{movie_movieId_const}}\",\r\n    \"nameEN\": \"{{movie_nameEN}}\",\r\n    \"country\": \"{{movie_country}}\",\r\n    \"director\": \"{{movie_director}}\",\r\n    \"duration\": \"{{movie_duration}}\",\r\n    \"year\": \"{{movie_year}}\",\r\n    \"description\": \"{{movie_description}}\",\r\n    \"image\": \"{{movie_link}}\",\r\n    \"trailerLink\": \"{{movie_link}}\",\r\n    \"thumbnail\": \"{{movie_link}}\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
						"url": {
							"raw": "{{base_url}}/movies",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"movies"
							]
						}
					},
					"response": []
				},
        {
          "name": "[-] [POST] Добавление фильма без обязательного поля thumbnail",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Код ответа равен 400\", () => {\r",
                  "    pm.response.to.have.status(400);\r",
                  "});\r",
                  "\r",
                  "pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('body', 'link', pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
              "mode": "raw",
              "raw": "{\r\n    \"movieId\": \"{{movie_movieId_const}}\",\r\n    \"nameRU\": \"{{movie_nameRU}}\",\r\n    \"nameEN\": \"{{movie_nameEN}}\",\r\n    \"country\": \"{{movie_country}}\",\r\n    \"director\": \"{{movie_director}}\",\r\n    \"duration\": \"{{movie_duration}}\",\r\n    \"year\": \"{{movie_year}}\",\r\n    \"description\": \"{{movie_description}}\",\r\n    \"image\": \"{{movie_link}}\",\r\n    \"trailerLink\": \"{{movie_link}}\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
						"url": {
							"raw": "{{base_url}}/movies",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"movies"
							]
						}
					},
					"response": []
				},
				{
					"name": "[+] [GET] Получение списка карточек",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Проверка списка карточек\", () => {\r",
									"    const response = utils.getData(pm.response.json());\r",
									"    \r",
									"    pm.expect(response).to.be.an(\"array\");\r",
									"    pm.expect(response.length).not.to.equal(0);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/movies",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"movies"
							]
						}
					},
					"response": []
				},
				{
					"name": "[+] [GET] Проверка отсутствия удаленной карточки в БД",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
                  "pm.test(\"Удаленной карточки не должно быть в БД\", () => {\r",
                  "    const cards = utils.getData(pm.response.json());\r",
                  "    const deletedId = pm.collectionVariables.get(\"movie_id\");\r",
                  "    const hasCard = !!cards?.find((item) => item._id === deletedId);\r",
                  "\r",
                  "    pm.expect(hasCard).to.eq(false);\r",
                  "});"
                ],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/movies",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"movies"
							]
						}
					},
					"response": []
				},
				{
					"name": "[+] [DELETE] Удаление фильма",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
              "raw": "{{base_url}}/movies/:_id",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "movies",
                ":_id"
              ],
              "variable": [
                {
                  "key": "_id",
                  "value": "{{movie_movieId}}"
                }
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [DELETE] Удаление фильма с некорректным id",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 400\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									"\r",
									"pm.test(\"Ошибка валидации поймана при помощи Joi\", () => {\r",
									"    const schema = utils.generateSchemaValidationError('params', null, pm.response.json());\r",
									"    pm.response.to.have.jsonSchema(schema);\r",
									"});\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/movies/:movieid",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"movies",
								":movieid"
							],
							"variable": [
								{
									"key": "movieid",
									"value": "text"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [DELETE] Удаление фильма с несуществующим в БД id",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 404\", () => {\r",
									"    pm.response.to.have.status(404);\r",
									"});\r",
									"\r",
									"pm.test(\"Проверка возврата поля message\", () => {\r",
									"    pm.response.to.have.jsonSchema(JSON.parse(pm.collectionVariables.get(\"schema_message_only\")));\r",
									"});\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/movies/:movieid",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"movies",
								":movieid"
							],
							"variable": [
								{
									"key": "movieid",
									"value": "{{user_id}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "* Добавление фильма",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const movie = utils.getData(pm.response.json());\r",
									"\r",
									"pm.collectionVariables.set(\"movie_movieId\", movie._id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
              "mode": "raw",
              "raw": "{\r\n    \"movieId\": \"{{movie_movieId_const}}\",\r\n    \"nameRU\": \"{{movie_nameRU}}\",\r\n    \"nameEN\": \"{{movie_nameEN}}\",\r\n    \"country\": \"{{movie_country}}\",\r\n    \"director\": \"{{movie_director}}\",\r\n    \"duration\": \"{{movie_duration}}\",\r\n    \"year\": \"{{movie_year}}\",\r\n    \"description\": \"{{movie_description}}\",\r\n    \"image\": \"{{movie_link}}\",\r\n    \"trailerLink\": \"{{movie_link}}\",\r\n    \"thumbnail\": \"{{movie_link}}\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
						"url": {
							"raw": "{{base_url}}/movies",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"movies"
							]
						}
					},
					"response": []
				},
				{
					"name": "* Авторизация другим пользователем",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"try {\r",
									"    const regex = /^[a-zA-Z0-9\\-_]+?\\.[a-zA-Z0-9\\-_]+?\\.([a-zA-Z0-9\\-_]+)?$/;\r",
									"    const data = utils.getData(pm.response.json());\r",
									"    const token = data.token || data[Object.keys(data)[0]];\r",
									"    if(regex.test(token)) {\r",
									"        pm.collectionVariables.set(\"jwt_token\", token);\r",
									"    }\r",
									"} catch (e) {\r",
									"}"
								]
							}
						}
					],
					"protocolProfileBehavior": {
						"disabledSystemHeaders": {}
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"{{user_email_third}}\",\r\n    \"password\": \"{{user_password}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/signin",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"signin"
							]
						}
					},
					"response": []
				},
				{
					"name": "[-] [DELETE] Удаление фильма другого пользователя",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Код ответа равен 403\", function () {\r",
									"    pm.response.to.have.status(403);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
              "raw": "{{base_url}}/movies/:_id",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "movies",
                ":_id"
              ],
              "variable": [
                {
                  "key": "_id",
                  "value": "{{movie_movieId}}"
                }
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "[-] [PATCH] Обработка неправильного пути",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test(\"Код ответа равен 404\", () => {\r",
							"    pm.response.to.have.status(404);\r",
							"});\r",
							"\r",
							"pm.test(\"Проверка возврата поля message\", () => {\r",
							"    pm.response.to.have.jsonSchema(JSON.parse(pm.collectionVariables.get(\"schema_message_only\")))\r",
							"});\r",
							""
						]
					}
				}
			],
			"request": {
				"method": "PATCH",
				"header": [],
				"url": {
					"raw": "{{base_url}}/404",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"404"
					]
				}
			},
			"response": []
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{jwt_token}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"const schemaMessageOnly = {",
					"    \"type\": \"object\",",
					"    \"properties\": {",
					"        \"message\": {",
					"            \"type\": \"string\",",
					"            \"minLength\": 1",
					"        }",
					"    },",
					"    \"required\": [\"message\"]",
					"};",
					"",
					"pm.collectionVariables.set(\"schema_message_only\", JSON.stringify(schemaMessageOnly));",
					"",
					"utils = {",
					"    getData: (jsonData) => {",
					"        if(Array.isArray(jsonData)) {",
					"            return jsonData;",
					"        }",
					"",
					"        const keys = Object.keys(jsonData);",
					"        const firstKey = keys[0];",
					"        const firstKeyValue = jsonData[firstKey];",
					"",
					"        return keys.length === 1 && typeof firstKeyValue === 'object' ? firstKeyValue : jsonData;",
					"    },",
					"    generateSchemaValidationError: (source, key, jsonData) => {",
					"        console.log(jsonData);",
					"        const validationProps = {",
					"            properties: {",
					"                source: {",
					"                    type: \"string\",",
					"                    const: source",
					"                },",
					"                keys: {",
					"                    type: \"array\",",
					"                    items: [",
					"                        {",
					"                            type: \"string\"",
					"                        }",
					"                    ]",
					"                }",
					"            },",
					"            required: [\"source\", \"keys\"]",
					"        };",
					"",
					"        if(key !== null) {",
					"            validationProps.properties.keys.items[0].const = key;",
					"        } ",
					"        ",
					"        const schema = {",
					"            type: 'object',",
					"            properties: {",
					"                statusCode: {",
					"                    type: 'integer'",
					"                },",
					"                error: {",
					"                    type: \"string\",",
					"                    const: \"Bad Request\"",
					"                },",
					"                message: {",
					"                    type: \"string\",",
					"                    minLength: 1",
					"                },",
					"                validation: {",
					"                    type: \"object\",",
					"                }",
					"            },",
					"            required: [\"statusCode\", \"error\", \"message\"]",
					"        }",
					"        ",
					"        if(Object.keys(jsonData?.validation).length === 1) {",
					"            schema.properties.validation.properties = {",
					"                [source]: {",
					"                    type: \"object\",",
					"                    ...validationProps",
					"                }",
					"            }",
					"            schema.properties.validation.required = [source]",
					"        } else {",
					"            schema.properties.validation = {...schema.properties.validation, ...validationProps}",
					"        }",
					"        ",
					"        return schema;",
					"    }",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"pm.test(\"В ответе приходит JSON-объект\", () => {",
					"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
					"});"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3000"
		},
		{
			"key": "user_name",
			"value": "test"
		},
		{
			"key": "user_email",
			"value": "em@em.ru"
		},
		{
			"key": "user_email_second",
			"value": "em2@em2.ru"
		},
		{
			"key": "user_email_third",
			"value": "em3@em3.ru"
		},
		{
			"key": "user_password",
			"value": "longPass"
		},
		{
			"key": "user_id",
			"value": ""
		},
		{
			"key": "user_id_const",
			"value": "61eade4c6d5acf558c42d9b8"
		},
		{
			"key": "user_name_default",
			"value": "Жак-Ив Кусто"
		},
		{
			"key": "user_name_changed",
			"value": "Обновленное имя"
		},
		{
			"key": "user_email_changed",
			"value": "em_changed@em.ru",
			"type": "string"
		},
		{
			"key": "user_email_incorrect",
			"value": "test"
		},
		{
			"key": "user_name_incorrect",
			"value": "1"
		},
		{
			"key": "card_name",
			"value": "testCard"
		},
		{
			"key": "movie_link",
			"value": "https://ya.ru/link.test"
		},
		{
			"key": "movie_link_incorrect",
			"value": "link:/link~!bad"
		},
    {
      "key": "movie_id",
      "value": ""
    },
		{
			"key": "schema_message_only",
			"value": ""
		},
		{
			"key": "user_password_incorrect",
			"value": "short"
		},
		{
			"key": "jwt_token",
			"value": ""
		},
		{
			"key": "movie_movieId",
			"value": "",
			"type": "string"
		},
    {
      "key": "movie_movieId_const",
      "value": "2132",
      "type": "string"
    },
		{
			"key": "movie_nameRU",
			"value": "Название",
			"type": "string"
		},
		{
			"key": "movie_nameEN",
			"value": "Title",
			"type": "string"
		},
		{
			"key": "movie_country",
			"value": "RU",
			"type": "string"
		},
		{
			"key": "movie_director",
			"value": "Test Name",
			"type": "string"
		},
		{
			"key": "movie_duration",
			"value": "123",
			"type": "string"
		},
		{
			"key": "movie_year",
			"value": "1900",
			"type": "string"
		},
		{
			"key": "movie_description",
			"value": "About",
			"type": "string"
		}
	]
}